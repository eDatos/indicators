-- ###########################################
-- # Create
-- ###########################################
-- Create pk sequence
    


-- Create normal entities
    
CREATE TABLE TB_INTERNATIONAL_STRINGS (
  ID BIGINT NOT NULL,
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL
);


CREATE TABLE TB_DATASETS (
  ID BIGINT NOT NULL,
  DATASET_ID VARCHAR(4000) NOT NULL,
  TABLE_NAME VARCHAR(100) NOT NULL,
  MAX_ATTRIBUTES_OBSERVATION INTEGER NOT NULL,
  LANGUAGES VARCHAR(100) NOT NULL,
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL
);


CREATE TABLE TB_ATTRIBUTES (
  ID BIGINT NOT NULL,
  ATTRIBUTE_ID VARCHAR(100) NOT NULL,
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL,
  VALUE_FK BIGINT NOT NULL,
  DATASET_FK BIGINT NOT NULL
);


CREATE TABLE TB_ATTRIBUTE_DIMENSIONS (
  ID BIGINT NOT NULL,
  DIMENSION_ID VARCHAR(100) NOT NULL,
  CODE_DIMENSION_ID VARCHAR(100),
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL,
  ATTRIBUTE_FK BIGINT NOT NULL
);


CREATE TABLE TB_DATASET_ATTRIBUTES (
  ID BIGINT NOT NULL,
  ATTRIBUTE_ID VARCHAR(100) NOT NULL,
  COLUMN_NAME VARCHAR(100),
  COLUMN_INDEX INTEGER,
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL,
  DATASET_FK BIGINT NOT NULL,
  ATTACHMENT_LEVEL VARCHAR(40) NOT NULL
);


CREATE TABLE TB_DATASET_DIMENSIONS (
  ID BIGINT NOT NULL,
  DIMENSION_ID VARCHAR(100) NOT NULL,
  COLUMN_NAME VARCHAR(100) NOT NULL,
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL,
  DATASET_FK BIGINT NOT NULL
);


CREATE TABLE TB_LOCALISED_STRINGS (
  ID BIGINT NOT NULL,
  LABEL VARCHAR(4000) NOT NULL,
  LOCALE VARCHAR(10) NOT NULL,
  UUID VARCHAR(36) NOT NULL,
  VERSION BIGINT NOT NULL,
  INTERNATIONAL_STRING_FK BIGINT NOT NULL
);



-- Create many to many relations
    

-- Primary keys
    
ALTER TABLE TB_INTERNATIONAL_STRINGS ADD CONSTRAINT PK_TB_INTERNATIONAL_STRINGS
	PRIMARY KEY (ID)
;

ALTER TABLE TB_DATASETS ADD CONSTRAINT PK_TB_DATASETS
	PRIMARY KEY (ID)
;

ALTER TABLE TB_ATTRIBUTES ADD CONSTRAINT PK_TB_ATTRIBUTES
	PRIMARY KEY (ID)
;

ALTER TABLE TB_ATTRIBUTE_DIMENSIONS ADD CONSTRAINT PK_TB_ATTRIBUTE_DIMENSIONS
	PRIMARY KEY (ID)
;

ALTER TABLE TB_DATASET_ATTRIBUTES ADD CONSTRAINT PK_TB_DATASET_ATTRIBUTES
	PRIMARY KEY (ID)
;

ALTER TABLE TB_DATASET_DIMENSIONS ADD CONSTRAINT PK_TB_DATASET_DIMENSIONS
	PRIMARY KEY (ID)
;

ALTER TABLE TB_LOCALISED_STRINGS ADD CONSTRAINT PK_TB_LOCALISED_STRINGS
	PRIMARY KEY (ID)
;

    

-- Unique constraints

ALTER TABLE TB_INTERNATIONAL_STRINGS
    ADD CONSTRAINT UQ_TB_INTERNATIONAL_STRINGS UNIQUE (UUID)
;


ALTER TABLE TB_DATASETS
    ADD CONSTRAINT UQ_TB_DATASETS UNIQUE (UUID)
;


ALTER TABLE TB_ATTRIBUTES
    ADD CONSTRAINT UQ_TB_ATTRIBUTES UNIQUE (UUID)
;


ALTER TABLE TB_ATTRIBUTE_DIMENSIONS
    ADD CONSTRAINT UQ_TB_ATTRIBUTE_DIMENSIONS UNIQUE (UUID)
;


ALTER TABLE TB_DATASET_ATTRIBUTES
    ADD CONSTRAINT UQ_TB_DATASET_ATTRIBUTES UNIQUE (UUID)
;


ALTER TABLE TB_DATASET_DIMENSIONS
    ADD CONSTRAINT UQ_TB_DATASET_DIMENSIONS UNIQUE (UUID)
;


ALTER TABLE TB_LOCALISED_STRINGS
    ADD CONSTRAINT UQ_TB_LOCALISED_STRINGS UNIQUE (UUID)
;



-- Foreign key constraints
    

  
  
  
  
ALTER TABLE TB_ATTRIBUTES ADD CONSTRAINT FK_TB_ATTRIBUTES_VALUE_FK
	FOREIGN KEY (VALUE_FK) REFERENCES TB_INTERNATIONAL_STRINGS (ID)
;
ALTER TABLE TB_ATTRIBUTES ADD CONSTRAINT FK_TB_ATTRIBUTES_DATASET_FK
	FOREIGN KEY (DATASET_FK) REFERENCES TB_DATASETS (ID) ON DELETE CASCADE
;

  
ALTER TABLE TB_ATTRIBUTE_DIMENSIONS ADD CONSTRAINT FK_TB_ATTRIBUTE_DIMENSIONS_ATTRIBUTE_FK
	FOREIGN KEY (ATTRIBUTE_FK) REFERENCES TB_ATTRIBUTES (ID) ON DELETE CASCADE
;

  
ALTER TABLE TB_DATASET_ATTRIBUTES ADD CONSTRAINT FK_TB_DATASET_ATTRIBUTES_DATASET_FK
	FOREIGN KEY (DATASET_FK) REFERENCES TB_DATASETS (ID) ON DELETE CASCADE
;

  
ALTER TABLE TB_DATASET_DIMENSIONS ADD CONSTRAINT FK_TB_DATASET_DIMENSIONS_DATASET_FK
	FOREIGN KEY (DATASET_FK) REFERENCES TB_DATASETS (ID) ON DELETE CASCADE
;

  
ALTER TABLE TB_LOCALISED_STRINGS ADD CONSTRAINT FK_TB_LOCALISED_STRINGS_INTERNATIONAL_STRING_FK
	FOREIGN KEY (INTERNATIONAL_STRING_FK) REFERENCES TB_INTERNATIONAL_STRINGS (ID) ON DELETE CASCADE
;

  

    

-- Index


    